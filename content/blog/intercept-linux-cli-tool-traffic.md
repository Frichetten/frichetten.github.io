---
title: "Intercept Linux CLI Tool Traffic"
date: 2020-01-11T17:16:40-06:00
description: A guide on how to intercept Linux CLI tool traffic with Burp Suite
link: intercept-linux-cli-tool-traffic
type: "blog"
---
<p>Recently I've been looking into flaws in a handful of Linux CLI tools. Many of these tools interact with APIs on remote systems. Obviously being able to intercept and inspect that traffic is very helpful for security researchers, Pentesters, Red Teamers, bug bounty hunters, or whatever you call yourself.</p><p>The following is a simple means of intercepting the traffic of Linux CLI tools with Burp Suite. For reference, all of this testing was performed on an Ubuntu 19.10 VM.<p><h3>Step 1: Set a Proxy for Our Shell</h3><p>First things first, we need to set up our proxy. This can be done very easily in many shells such as Bash and Zsh. The following commands will do this:</p><center><pre style="padding: 0.2rem 0.4rem; font-size: 90%; color: #0ea31b; background-color: #000000; border-radius: 0.01rem; padding: 0.2rem 0.4rem; font-size: 90%; color: #0ea31b; background-color: #000000; border-radius: 0.25rem; word-wrap:break-word ; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; ">$ export http_proxy="http://192.168.122.1:8080"<br>$ export https_proxy="http://192.168.122.1:8080"</pre></center><p>Here, 192.168.122.1 on port 8080 is where I have my Burp proxy listening (I use KVM and this is the default subnet VM's spawn on in case you are confused). So far so good. We can actually start intercepting traffic. For example, here I am curling my website.</p><p style="text-align:center"><img src="/images/blog/intercept-linux-cli-tool-traffic/curl_http.png" alt="Showing the output of curling a non SSL website." style="max-width:95%" class="img-responsive"></p><p style="text-align:center"><img src="/images/blog/intercept-linux-cli-tool-traffic/burp_http.png" alt="Showing the output of Burp when curling a non SSL website." style="max-width:95%" class="img-responsive"></p><p>Fantastic, it looks like that gives us a 301 response (redirecting us to the https version of the site), what happens when we follow it?</p><p style="text-align:center"><img src="/images/blog/intercept-linux-cli-tool-traffic/curl_fail.png" alt="Showing the output of curling an SSL website. This fails due to certificate error." style="max-width:95%" class="img-responsive"></p><p>Ah, that's right. Tools should validate the TLS/SSL cert and drop the connection if they aren't correct (if the tool you're looking at doesnâ€™t do this, that's a finding). In this instance, Curl is behaving appropriately and many tools will give you this same response. How do we get around this?</p><h3>Step 2: Import the Burp Suite Cert in Ubuntu</h3><p>Many folks who have used Burp Suite to intercept traffic from a browser will be familiar with this problem. The browser sees that the proxy uses PortSwigger's CA and then drops the connection. This is a simple fix with a web browser, but what about with an OS?</p><p>On Ubuntu it's actually pretty simple (and presumably simple on other Debian distros like Kali). First we need to download that cert.</p><center><pre style="padding: 0.2rem 0.4rem; font-size: 90%; color: #0ea31b; background-color: #000000; border-radius: 0.01rem; padding: 0.2rem 0.4rem; font-size: 90%; color: #0ea31b; background-color: #000000; border-radius: 0.25rem; word-wrap:break-word ; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; ">$ cd ~/Downloads<br>$ wget http://192.168.122.1:8080/cert</pre></center><p>The file we just downloaded is in the DER format. We need to instead convert it to ".crt" and move it into the "/usr/local/share/ca-certificates" directory as shown below.</p><center><pre style="padding: 0.2rem 0.4rem; font-size: 90%; color: #0ea31b; background-color: #000000; border-radius: 0.01rem; padding: 0.2rem 0.4rem; font-size: 90%; color: #0ea31b; background-color: #000000; border-radius: 0.25rem; word-wrap:break-word ; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; ">$ openssl x509 -in cert -inform DER -out burp_suite.crt<br>$ sudo mv burp_suite.crt /usr/local/share/ca-certificates</pre></center><p>Our final step is to run "update-ca-certificates" which will update our certificates under "/etc/ssl/certs".<center><code>$ sudo update-ca-certificates</code></center><br><p>Next, we can test out our changes by curling an SSL or TLS website.</p><p style="text-align:center"><img src="/images/blog/intercept-linux-cli-tool-traffic/curl_success.png" alt="Showing the interception of traffic on an SSL enabled website." style="max-width:95%" class="img-responsive"></p><p>And there you have it. We can now intercept SSL traffic of some Linux CLI tools. For example, eksctl which is a tool to interact with AWS EKS.</p><p style="text-align:center"><img src="/images/blog/intercept-linux-cli-tool-traffic/intercept_eks_1.png" alt="Showing the interception of traffic on eksctl." style="max-width:95%" class="img-responsive"></p><p style="text-align:center"><img src="/images/blog/intercept-linux-cli-tool-traffic/intercept_eks_2.png" alt="Showing the interception of traffic on eksctl." style="max-width:95%" class="img-responsive"></p>
